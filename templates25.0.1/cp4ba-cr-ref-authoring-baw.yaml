###############################################################################
##
##Licensed Materials - Property of IBM
##
##(C) Copyright IBM Corp. 2022, 2023. All Rights Reserved.
##
##US Government Users Restricted Rights - Use, duplication or
##disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
##
###############################################################################
##
##============================================================================================
## DISCLAIMER
## These configurations are not indicated or intended to be valid for production environments.
## The purpose is purely educational.
##============================================================================================
##
## DEPLOYMENT CONTENTS
## 
## patterns: foundation,baw_authoring
##
## https://www.ibm.com/docs/en/cloud-paks/cp-biz-automation/25.0.1?topic=parameters-business-automation-workflow-authoring
###############################################################################
apiVersion: icp4a.ibm.com/v1
kind: ICP4ACluster
metadata:
  name: ${CP4BA_INST_CR_NAME}
  namespace: ${CP4BA_INST_NAMESPACE}
  labels:
    app.kubernetes.io/instance: ibm-dba
    app.kubernetes.io/managed-by: ibm-dba
    app.kubernetes.io/name: ibm-dba
    release: "${CP4BA_BASE_VER}"

    # new v25
    cp4ba.ibm.com/backup-type: mandatory

  annotations:
    kubernetes.io/description: "${CP4BA_INST_DESCRIPTION}"
spec:

  appVersion: "${CP4BA_BASE_VER}"
  ibm_license: accept

  shared_configuration:
    sc_deployment_fncm_license: "non-production"
    sc_deployment_baw_license: "non-production"
    sc_deployment_license: "non-production"
    sc_deployment_context: "CP4A"
    sc_image_repository: cp.icr.io
    root_ca_secret: icp4a-root-ca
    sc_deployment_patterns: "${CP4BA_INST_DEPL_PATTERNS}"
    sc_optional_components: "${CP4BA_INST_OPT_COMPONENTS}"
    sc_deployment_type: "Production"
    sc_deployment_platform: "${CP4BA_INST_PLATFORM}"
    sc_deployment_profile_size: "${CP4BA_INST_DEPL_PROFILE_SIZE}"
    sc_ingress_enable: false
    trusted_certificate_list: []
    storage_configuration:
      sc_dynamic_storage_classname: "${CP4BA_INST_SC_FILE}"
      sc_slow_file_storage_classname: "${CP4BA_INST_SC_FILE}"
      sc_medium_file_storage_classname: "${CP4BA_INST_SC_FILE}"
      sc_fast_file_storage_classname: "${CP4BA_INST_SC_FILE}"
      sc_block_storage_classname: "${CP4BA_INST_SC_BLOCK}"
    sc_iam:
      default_admin_username: "${CP4BA_INST_IAM_ADMIN_USER}"
    enable_fips: false
    sc_egress_configuration:
      sc_restricted_internet_access: false
    sc_content_initialization: true
    sc_content_verification: false
    encryption_key_secret: ibm-iaws-shared-key-secret
    image_pull_secrets:
      - ibm-entitlement-key
    no_log: false
    show_sensitive_log: true

    # new v25
    sc_is_multiple_az: false
    sc_generate_sample_network_policies: false
    images:
      keytool_job_container:
        repository: cp.icr.io/cp/cp4a/baw/dba-keytool-jobcontainer
        tag: "${CP4BA_INST_IMGTAG}"
      dbcompatibility_init_container:
        repository: cp.icr.io/cp/cp4a/baw/dba-dbcompatibility-initcontainer
        tag: "${CP4BA_INST_IMGTAG}"
      keytool_init_container:
        repository: cp.icr.io/cp/cp4a/baw/dba-keytool-initcontainer
        tag: "${CP4BA_INST_IMGTAG}"
      umsregistration_initjob:
        repository: cp.icr.io/cp/cp4a/baw/dba-umsregistration-initjob
        tag: "${CP4BA_INST_IMGTAG}"

      ## All CP4A components should use this pull_policy as the default, but it can override by each component
      pull_policy: IfNotPresent

    sc_drivers_url:

  ldap_configuration:
    lc_selected_ldap_type: "Custom"
    lc_ldap_server: "${CP4BA_INST_LDAP_HOST}"
    lc_ldap_port: "${CP4BA_INST_LDAP_PORT}"
    lc_bind_secret: "${CP4BA_INST_LDAP_SECRET}"
    lc_ldap_base_dn: "${CP4BA_INST_LDAP_BASE_DOMAIN}"
    lc_ldap_ssl_enabled: false
    lc_ldap_ssl_secret_name: ""
    lc_ldap_user_name_attribute: "*:cn"
    lc_ldap_user_display_name_attr: "cn"
    lc_ldap_group_base_dn: "${CP4BA_INST_LDAP_BASE_DOMAIN}"
    lc_ldap_group_name_attribute: "*:cn"
    lc_ldap_group_display_name_attr: "cn"
    lc_ldap_group_membership_search_filter: "(&(cn=%v)(objectclass=groupOfNames))"
    lc_ldap_group_member_id_map: "memberof:member"
    lc_ldap_recursive_search: true
    lc_enable_pagination: false
    lc_pagination_size: 4500     
    custom:
      lc_user_filter: "(&(cn=%v)(objectclass=person))"
      lc_group_filter: "(&(cn=%v)(objectclass=groupOfNames))"

    # new v25 (to be verified...)
    scim_configuration_iam:
      user_unique_id_attribute: "uid"
      user_name_attribute: "cn"
      user_principal_name_attribute: "cn"
      user_display_name_attribute: "cn"
      user_given_name_attribute: "cn"
      user_family_name_attribute: "sn"
      user_full_name_attribute: "cn"
      user_external_id_attribute: "dn"
      user_emails_attribute: "mail"
      user_created_attribute: "createTimestamp"
      user_lastmodified_attribute: "modifyTimestamp"
      user_phonenumbers:
      - value: "mobile"
        type: "mobile"
      - value: "telephoneNumber"
        type: "work"
      user_object_class_attribute: "organizationalPerson"
      user_groups_attribute: "member"
      group_unique_id_attribute: "cn"
      group_name_attribute: "cn"
      group_principal_name_attribute: "cn"
      group_display_name_attribute: "cn"
      group_external_id_attribute: "dn"
      group_created_attribute: "createTimestamp"
      group_lastmodified_attribute: "modifyTimestamp"
      group_object_class_attribute: "groupOfNames"
      group_members_attribute: "member"

  datasource_configuration:
    dc_ssl_enabled: false

    dc_icn_datasource:
      dc_database_type: ${CP4BA_INST_DB_SERVER_TYPE}
      dc_common_icn_datasource_name: "ECMClientDS"
      database_servername: "${CP4BA_INST_DB_1_SERVER_NAME}"
      database_port: "${CP4BA_INST_DB_SERVER_PORT}"
      database_name: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_icn"
      database_ssl_secret_name: ""
      dc_hadr_validation_timeout: 15
      dc_hadr_standby_servername: ""
      dc_hadr_standby_port: ""
      dc_hadr_retry_interval_for_client_reroute: 15
      dc_hadr_max_retries_for_client_reroute: 3

    dc_gcd_datasource:
      dc_database_type: ${CP4BA_INST_DB_SERVER_TYPE}
      dc_common_gcd_datasource_name: "FNGCDDS"
      dc_common_gcd_xa_datasource_name: "FNGCDDSXA"
      database_servername: "${CP4BA_INST_DB_1_SERVER_NAME}"
      database_name: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_gcd"
      database_port: "${CP4BA_INST_DB_SERVER_PORT}"
      database_ssl_secret_name: ""
      dc_hadr_validation_timeout: 15
      dc_hadr_standby_servername: ""
      dc_hadr_standby_port: ""
      dc_hadr_retry_interval_for_client_reroute: 15
      dc_hadr_max_retries_for_client_reroute: 3

    dc_os_datasources:
      - dc_database_type: ${CP4BA_INST_DB_SERVER_TYPE}
        dc_os_label: "${CP4BA_INST_DB_BAWDOCS_LBL}"
        dc_common_os_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOCS}"
        dc_common_os_xa_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOCS}XA"
        database_servername: "${CP4BA_INST_DB_1_SERVER_NAME}"
        database_name: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_bawdocs"
        database_port: "${CP4BA_INST_DB_SERVER_PORT}"
        database_ssl_secret_name: ""
        dc_hadr_validation_timeout: 15
        dc_hadr_standby_servername: ""
        dc_hadr_standby_port: ""
        dc_hadr_retry_interval_for_client_reroute: 15
        dc_hadr_max_retries_for_client_reroute: 3

      - dc_database_type: ${CP4BA_INST_DB_SERVER_TYPE}
        dc_os_label: "${CP4BA_INST_DB_BAWDOS_LBL}"
        dc_common_os_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOS}"
        dc_common_os_xa_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOS}XA"
        database_servername: "${CP4BA_INST_DB_1_SERVER_NAME}"
        database_name: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_bawdos"
        database_port: "${CP4BA_INST_DB_SERVER_PORT}"
        database_ssl_secret_name: ""
        dc_oracle_os_jdbc_url: ""
        dc_hadr_validation_timeout: 15
        dc_hadr_standby_servername: ""
        dc_hadr_standby_port: ""
        dc_hadr_retry_interval_for_client_reroute: 15
        dc_hadr_max_retries_for_client_reroute: 3

      - dc_database_type: ${CP4BA_INST_DB_SERVER_TYPE}
        dc_os_label: "${CP4BA_INST_DB_BAWTOS_LBL}"
        dc_common_os_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS}"
        dc_common_os_xa_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS}XA"
        database_servername: "${CP4BA_INST_DB_1_SERVER_NAME}"
        database_name: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_bawtos"
        database_port: "${CP4BA_INST_DB_SERVER_PORT}"
        database_ssl_secret_name: ""
        dc_hadr_validation_timeout: 15
        dc_hadr_standby_servername: ""
        dc_hadr_standby_port: ""
        dc_hadr_retry_interval_for_client_reroute: 15
        dc_hadr_max_retries_for_client_reroute: 3

      - dc_database_type: ${CP4BA_INST_DB_SERVER_TYPE}
        dc_os_label: "${CP4BA_INST_DB_CONTENT_LBL}"
        dc_common_os_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}"
        dc_common_os_xa_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}XA"
        database_servername: "${CP4BA_INST_DB_1_SERVER_NAME}"
        database_name: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_content"
        database_port: "${CP4BA_INST_DB_SERVER_PORT}"
        database_ssl_secret_name: ""
        dc_hadr_validation_timeout: 15
        dc_hadr_standby_servername: ""
        dc_hadr_standby_port: ""
        dc_hadr_retry_interval_for_client_reroute: 15
        dc_hadr_max_retries_for_client_reroute: 3

      - dc_database_type: ${CP4BA_INST_DB_SERVER_TYPE}
        dc_os_label: "${CP4BA_INST_DB_OS_LBL}"
        dc_common_os_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1OS1}"
        dc_common_os_xa_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1OS1}XA"
        database_servername: "${CP4BA_INST_DB_1_SERVER_NAME}"
        database_name: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_os1"
        database_port: "${CP4BA_INST_DB_SERVER_PORT}"
        database_ssl_secret_name: ""
        dc_hadr_validation_timeout: 15
        dc_hadr_standby_servername: ""
        dc_hadr_standby_port: ""
        dc_hadr_retry_interval_for_client_reroute: 15
        dc_hadr_max_retries_for_client_reroute: 3

      - dc_database_type: ${CP4BA_INST_DB_SERVER_TYPE}
        dc_os_label: "${CP4BA_INST_DB_AE_LBL}"
        dc_common_os_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1AE}"
        dc_common_os_xa_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1AE}XA"
        database_servername: "${CP4BA_INST_DB_1_SERVER_NAME}"
        database_name: "${CP4BA_INST_AE_DB_NAME}"
        database_port: "${CP4BA_INST_DB_SERVER_PORT}"
        database_ssl_secret_name: ""
        dc_hadr_validation_timeout: 15
        dc_hadr_standby_servername: ""
        dc_hadr_standby_port: ""
        dc_hadr_retry_interval_for_client_reroute: 15
        dc_hadr_max_retries_for_client_reroute: 3

  # IBM FileNet Content Manager initialize configuration
  # https://www.ibm.com/docs/en/cloud-paks/cp-biz-automation/25.0.1?topic=parameters-initialization
  initialize_configuration:
    ic_ldap_creation:
      ic_ldap_admin_user_name:
        - "${CP4BA_INST_PAKBA_ADMIN_USER}"
      ic_ldap_admins_groups_name:
        - "${CP4BA_INST_PAKBA_ADMIN_GROUP}"
    ic_domain_creation:
      domain_name: "P8DOMAIN"
      encryption_key: "128"
    ic_obj_store_creation:

      object_stores:

        - oc_cpe_obj_store_display_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOCS}"
          oc_cpe_obj_store_symb_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOCS}"
          oc_cpe_obj_store_conn:
            name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOCS_CONN_NAME}"
            dc_os_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOCS}"
            dc_os_xa_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOCS}XA"
          oc_cpe_obj_store_admin_user_groups:
            - "${CP4BA_INST_PAKBA_ADMIN_USER}"
            - "${CP4BA_INST_PAKBA_ADMIN_GROUP}"

        - oc_cpe_obj_store_display_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOS}"
          oc_cpe_obj_store_symb_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOS}"
          oc_cpe_obj_store_conn:
            name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOS_CONN_NAME}"
            dc_os_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOS}"
            dc_os_xa_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOS}XA"
          oc_cpe_obj_store_admin_user_groups:
            - "${CP4BA_INST_PAKBA_ADMIN_USER}"
            - "${CP4BA_INST_PAKBA_ADMIN_GROUP}"
          
        - oc_cpe_obj_store_display_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS}"
          oc_cpe_obj_store_symb_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS}"
          oc_cpe_obj_store_conn:
            name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS_CONN_NAME}"
            site_name: InitialSite
            dc_os_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS}"
            dc_os_xa_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS}XA"
          oc_cpe_obj_store_admin_user_groups:
            - "${CP4BA_INST_PAKBA_ADMIN_USER}"
            - "${CP4BA_INST_PAKBA_ADMIN_GROUP}"
          oc_cpe_obj_store_enable_compression: false
          oc_cpe_obj_store_enable_content_event_emitter: false
          oc_cpe_obj_store_enable_workflow: true
          oc_cpe_obj_store_workflow_locale: en
          oc_cpe_obj_store_workflow_region_number: ${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS_REGION_NUM}
          oc_cpe_obj_store_workflow_region_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS_REGION_NAME}"
          oc_cpe_obj_store_workflow_date_time_mask: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS_DT_MASK}"
          oc_cpe_obj_store_workflow_data_tbl_space: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_${CP4BA_INST_DB_TOS_SCHEMA_DATA}"
          oc_cpe_obj_store_workflow_index_tbl_space: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_${CP4BA_INST_DB_TOS_SCHEMA_INDEX}"
          oc_cpe_obj_store_workflow_blob_tbl_space: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_${CP4BA_INST_DB_TOS_SCHEMA_BLOB}"          
          oc_cpe_obj_store_workflow_admin_group: "${CP4BA_INST_PAKBA_ADMIN_GROUP}"
          oc_cpe_obj_store_workflow_config_group: "${CP4BA_INST_PAKBA_ADMIN_GROUP}"
          oc_cpe_obj_store_workflow_pe_conn_point_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS_PE_CONN_POINT_NAME}"
            
        - oc_cpe_obj_store_display_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1AE}"
          oc_cpe_obj_store_symb_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1AE}"
          oc_cpe_obj_store_conn:
            name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1AE_CONN_NAME}"
            dc_os_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1AE}"
            dc_os_xa_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1AE}XA"
          oc_cpe_obj_store_admin_user_groups:
            - "${CP4BA_INST_PAKBA_ADMIN_USER}"
            - "${CP4BA_INST_PAKBA_ADMIN_GROUP}"

        # CONTENT
        - oc_cpe_obj_store_display_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}"
          oc_cpe_obj_store_symb_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}"
          oc_cpe_obj_store_conn:
            name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT_CONN_NAME}"
            dc_os_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}"
            dc_os_xa_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}XA"
          oc_cpe_obj_store_admin_user_groups:
            - "${CP4BA_INST_PAKBA_ADMIN_USER}"
            - "${CP4BA_INST_PAKBA_ADMIN_GROUP}"
          oc_cpe_obj_store_enable_content_event_emitter: false
          oc_cpe_obj_store_enable_workflow: true
          oc_cpe_obj_store_workflow_admin_group: "${CP4BA_INST_PAKBA_ADMIN_GROUP}"
          oc_cpe_obj_store_workflow_config_group: "${CP4BA_INST_PAKBA_ADMIN_GROUP}"
          oc_cpe_obj_store_workflow_data_tbl_space: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_${CP4BA_INST_DB_CONTENT_SCHEMA_DATA}"
          oc_cpe_obj_store_workflow_index_tbl_space: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_${CP4BA_INST_DB_CONTENT_SCHEMA_INDEX}"
          oc_cpe_obj_store_workflow_blob_tbl_space: "${CP4BA_INST_ENV_FOR_DB_PREFIX}_${CP4BA_INST_DB_CONTENT_SCHEMA_BLOB}"          
          oc_cpe_obj_store_workflow_pe_conn_point_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT_PE_CONN_POINT_NAME}"
          oc_cpe_obj_store_workflow_region_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT_REGION_NAME}"
          oc_cpe_obj_store_addons_list:
          - '{CE460ADD-0000-0000-0000-000000000004}'
          - '{CE460ADD-0000-0000-0000-000000000001}'
          - '{CE460ADD-0000-0000-0000-000000000003}'
          - '{CE511ADD-0000-0000-0000-000000000006}'
          - '{CE460ADD-0000-0000-0000-000000000008}'
          - '{CE460ADD-0000-0000-0000-000000000007}'
          - '{CE460ADD-0000-0000-0000-000000000009}'
          - '{CE460ADD-0000-0000-0000-00000000000A}'
          - '{CE460ADD-0000-0000-0000-00000000000B}'
          - '{CE460ADD-0000-0000-0000-00000000000D}'
          - '{CE511ADD-0000-0000-0000-00000000000F}'
          - '{CE511ADD-0000-0000-0000-000000000010}'
          - '{CE511ADD-0000-0000-0000-000000000015}'
          - '{CE521ADD-0000-0000-0000-000000000016}'
          - '{CE552ADD-0000-0000-0000-00000000001C}'
          - '{CE551ADD-0000-0000-0000-000000000011}'
          - '{CE554ADD-0000-0000-0000-000000000021}'

        - oc_cpe_obj_store_display_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1OS1}"
          oc_cpe_obj_store_symb_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1OS1}"
          oc_cpe_obj_store_conn:
            name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1OS1_CONN_NAME}"
            dc_os_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1OS1}"
            dc_os_xa_datasource_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1OS1}XA"
          oc_cpe_obj_store_admin_user_groups:
            - "${CP4BA_INST_PAKBA_ADMIN_USER}"
            - "${CP4BA_INST_PAKBA_ADMIN_GROUP}"

    ic_icn_init_info:
      icn_repos:
        - add_repo_id: "my_demo_repo1"
          add_repo_ce_wsi_url: "https://{{ meta.name }}-cpe-stateless-svc.{{ meta.namespace }}.svc:9443/wsi/FNCEWS40MTOM/"
          add_repo_os_sym_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1OS1}"
          add_repo_os_dis_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1OS1}"
          add_repo_workflow_enable: false
          add_repo_work_conn_pnt: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1OS1_CONN_NAME}:${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS_REGION_NUM}"
          add_repo_protocol: "FileNetP8WSI"

        - add_repo_id: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}"
          add_repo_ce_wsi_url: "https://{{ meta.name }}-cpe-stateless-svc.{{ meta.namespace }}.svc:9443/wsi/FNCEWS40MTOM/"
          add_repo_os_sym_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}"
          add_repo_os_dis_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}"
          add_repo_workflow_enable: false
          add_repo_work_conn_pnt: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT_CONN_NAME}:${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT_REGION_NUM}"
          add_repo_protocol: "FileNetP8WSI"

      icn_desktop:
        - add_desktop_id: "my_demo"
          add_desktop_name: "icn_desktop"
          add_desktop_description: "This is My ICN desktop"
          add_desktop_is_default: false
          add_desktop_repo_id: "my_demo_repo1"
          add_desktop_repo_workflow_enable: false

        - add_desktop_description: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}"
          add_desktop_id: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}"
          add_desktop_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}"
          add_desktop_repo_id: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1CONTENT}"

  # IBM Business Automation Workflow Authoring configuration
  # https://www.ibm.com/docs/en/cloud-paks/cp-biz-automation/25.0.1?topic=parameters-business-automation-studio
  bastudio_configuration:
    admin_user: "${CP4BA_INST_PAKBA_ADMIN_USER}"
    bastudio_custom_xml: |
      <properties>
        <authoring-environment>
          <authoring-agent-endpoint merge="replace">https://${CP4BA_INST_CPD_CONSOLE_PREFIX}.${CP4BA_INST_CPD_CONSOLE_FQDN_SUFFIX}/agent</authoring-agent-endpoint>
        </authoring-environment>
      </properties>
    database:
      host: ${CP4BA_INST_DB_1_SERVER_NAME}
      name: ${CP4BA_INST_BAS_1_DB_BAW_NAME}
      port: "${CP4BA_INST_BAS_1_DB_PORT}"
      type: ${CP4BA_INST_DB_SERVER_TYPE}
    playback_server:
      admin_user: "${CP4BA_INST_PAKBA_ADMIN_USER}"
      database:
        host: ${CP4BA_INST_DB_1_SERVER_NAME}
        name: ${CP4BA_INST_BAS_1_DB_PBK_NAME}
        port: "${CP4BA_INST_BAS_1_DB_PORT}"
        type: ${CP4BA_INST_DB_SERVER_TYPE}
    tls:
      tlsTrustList: []

  # Business Automation Workflow Authoring
  # https://www.ibm.com/docs/en/cloud-paks/cp-biz-automation/25.0.1?topic=parameters-business-automation-workflow-authoring
  workflow_authoring_configuration:

    ## The configurations for content integration for attachment in process
    content_integration:
      ## Domain name for content integration. The value must be the same as initialize_configuration.ic_domain_creation.domain_name.
      domain_name: "P8DOMAIN"
      object_store_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOCS}"

    ## The configuration for case
    case:
      ## Domain name for CASE. The value must be the same as initialize_configuration.ic_domain_creation.domain_name.
      domain_name: "P8DOMAIN"
      object_store_name_dos: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1DOS}"
      tos_list:
      - object_store_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS}"
        connection_point_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS_PE_CONN_POINT_NAME}"
        target_environment_name: "dev_env_connection_definition"

      network_shared_directory_pvc: "{{ navigator_configuration.datavolume.existing_pvc_for_icn_pluginstore.name | default('icn-pluginstore', true) }}"
      ## Custom package names for installing custom packages, where the value format is similar to package1.zip, package2.zip.
      custom_package_names: ""
      ## Custom extension names for installing custom packages, where the value format is similar to extension1.zip, extension2.zip.
      custom_extension_names: ""
      cpe_metadata_cache_time_to_live: ""

      ## The event emitter settings if you want to enable Case Event Emitter. The following example shows sample values:
      ## event_emitter:
      ##   date_sql: 20200630T002840Z
      ##   logical_unique_id: bawinst1
      ##   solution_list: SampleSolution1,SampleSolution2
      ## event_emitter:
      ## - tos_name:
      ##   ## Connection point name for Target Object Store.
      ##   connection_point_name:
      ##   ## Creation date of the events.
      ##   ## The emitter starts processing the events from that date. If a bookmark exists, the emitter ignores this parameter and processes the events from the bookmark.
      ##   date_sql:
      ##   ## An 8-character alphanumeric string without underscores.
      ##   ## This value is always required. While processing, the emitter tracks the events that are processed by using the Content Engine Audit Processing Bookmark with a display name that is based on this value.
      ##   ## Therefore, if the emitter is restarted and if the bookmark exists, the emitter processes the events from the last bookmark.
      ##   logical_unique_id:
      ##   ## Comma-separated list of all the case solution names that need to be processed. Add all the solutions that you want to be processed before you deploy the Case event emitter.
      ##   solution_list:
      ##   ## Comma-separated list of all the case types that need to be processed.
      ##   casetype_list:
      ##   ## Case event emitter batch size.
      ##   emitter_batch_size:
      ##   ## Whether to process FileNet Process Engine events in addition to IBM Business Automation Workflow events.
      ##   process_pe_events:

      ## The event emitter settings if you want to enable Case History Emitter. The following example shows sample values:
      ## case_history_emitter:
      ##   enable: true
      ##   dc_common_cpe_datasource_name: "CASEHISTORYDS"
      ##   case_history_store_schema_name: "CHSCHEMA"
      ##
      ## case_history_emitter:
      ##   ## To enable Case History Emitter, this parameter must be set to true.
      ##   enable: false
      ##   ## The name of the non-XA datasource of Case History Store (from dc_common_cpe_datasource_name in the dc_cpe_datasources section)
      ##   ## This value is always required. To enable Case History Emitter, add the Case History database configuration in the dc_cpe_datasources section, and specify the non-XA datasource name(dc_common_cpe_datasource_name) as the value of this parameter.
      ##   dc_common_cpe_datasource_name: "<Required>"
      ##   ## The schema name for Case History Store.
      ##   case_history_store_schema_name: "CHSCHEMA"
    
    ## Application engine configuration, because application engine is an array,
    ## when there is only one Application engine deployed along with this CR, below four parameters are not required.
    ## when there is more then one application engine deployed, below four parameters are required.
    ## appengine:
    ##   ## App Engine hostname
    ##   hostname: ""
    ##   ## App Engine port
    ##   port: "443"
    ##   ## App Engine admin secret name
    ##   admin_secret_name: ""
    ##   ## App Engine context root.
    ##   ## The application default context root will be /{{ meta.name}}-{{ application engine instance name }}-aae
    ##   ## Please adjust this value according to the App Engine instance you selected. Don't miss the slash in front of value
    ##   context_root: ""


    ## storage configuration
    storage:
      use_dynamic_provisioning: ${CP4BA_INST_BAWAUTHORING_STORAGE_DYNAMIC_PROVISIONING}
      size_for_filestore: "${CP4BA_INST_BAWAUTHORING_STORAGE_SIZE}"

    ## customize environment settings
    environment_config:
      ## Whether to show the Intelligent Task Prioritization service toggle button in the web user interface to allow the user to enable or disable this service.
      show_task_prioritization_service_toggle: ${CP4BA_INST_BAWAUTHORING_TASK_PRIORITIZATION_SERVICE_TOGGLE}
      ## Whether to display the Intelligent Task Prioritization service toggle button. If this parameter is set to true, the previous parameter is ignored.
      always_run_task_prioritization_service: ${CP4BA_INST_BAWAUTHORING_ALWAYS_RUN_TASK_PRIORITIZATION_SERVICE}

      # csrf:
      #   ## Acceptable values in the Origin header field. The value of this property must be a comma-separated list of prefixes in the format protocol://host:port, e.g "https://example.com, http://example2.com:8080".
      #   origin_allowlist:
      #   ## Acceptable values in the Referer header field. The value of this property must be a comma-separated list of fully qualified host names, e.g "example1.com, example2.com".
      #   referer_allowlist:
      # Content security policy additional directive for all folders , e.g. ["https://hostname1","https://hostname2"]
      # content_security_policy_additional_all: []
      # ## Content security policy additional directive for default-src , e.g. ["https://hostname1","https://hostname2"]
      # content_security_policy_additional_default_src: []
      # ## Content security policy additional directive for script-src , e.g. ["https://hostname1","https://hostname2"]
      # content_security_policy_additional_script_src: []
      # ## Content security policy additional directive for frame-src , e.g. ["https://hostname1","https://hostname2"]
      # content_security_policy_additional_frame_src: []
      # ## Content security policy additional directive for object-src , e.g. ["https://hostname1","https://hostname2"]
      # content_security_policy_additional_object_src: []
      # ## Content security policy additional directive for connect-src , e.g. ["https://hostname1","https://hostname2"]
      # content_security_policy_additional_connect_src: []
      # ## Content security policy additional directive for frame-ancestor, e.g. ["https://hostname1","https://hostname2"]
      # content_security_policy_additional_frame_ancestor: []
      # ## Content security policy additional directive for img-src, e.g. ["https://hostname1","https://hostname2"]
      # content_security_policy_additional_img_src: []
      # ## Content security policy additional directive for font-src, e.g. ["https://hostname1","https://hostname2"]
      # content_security_policy_additional_font_src: []
      # ## Content security policy additional directive for style-src, e.g. ["https://hostname1","https://hostname2"]
      # content_security_policy_additional_style_src: []

    ## federation config
    federation_config:
      # workflow_server:
      #     ## Number of primary shards of the Elasticsearch/Opensearch index used to store Workflow Authoring data.
      #     index_number_of_shards: 3
      #     ## Number of shard replicas of the Elasticsearch/Opensearch index used to store Workflow Authoring data.
      #     index_number_of_replicas: 1
      case_manager:
            ## Case Manager object store name.
          - object_store_name: "${CP4BA_INST_CPE_OBJSTORAGE_BAWINS1TOS}"
            ## Number of primary shards of the Elasticsearch/Opensearch index used to store Case Manager object store data.
            # index_number_of_shards: 3
            ## Number of shard replicas of the Elasticsearch/Opensearch index used to store Case Manager object store data.
            # index_number_of_replicas: 1

    ## JVM options separated with spaces, for example: -Dtest1=test -Dtest2=test2.
    ## jvm_customize_options:

    ##  Workflow Authoring custom plain XML snippet
    ##  liberty_custom_xml: |+
    ##    <server>
    ##      <!-- custom propeties here -->
    ##    </server>
    ## The custom_xml_secret_name is also used for Workflow Authoring customization. Ensure the configuration value exists either in liberty_custom_xml or custom_xml_secret_name.
    ## Do not set the configuration value in both places.
    ## liberty_custom_xml:

    ## Workflow Authoring custom XML secret name that contains custom configuration in Liberty server.xml,
    ## put the custom.xml in secret with key "sensitiveCustomConfig"
    ## kubectl create secret generic wfs-custom-xml-secret --from-file=sensitiveCustomConfig=./custom.xml
    ## The liberty_custom_xml property is also used for Workflow Authoring customization. Ensure the configuration value exists either in liberty_custom_xml or custom_xml_secret_name.
    ## Do not set the configuration value in both places
    custom_xml_secret_name: my-liberty-custom-xml-secret

    #  kubectl create secret generic wfs-lombardi-custom-xml-secret --from-file=sensitiveCustomConfig=./100Custom.xml
    lombardi_custom_xml_secret_name: my-lombardi-custom-xml-secret

    ##  ??? IBM Business Automation Insights integration configuration
    ## business_event:
    ##   ## Whether to enable event monitoring for Dynamic Event Framework events for the Workflow Services container.
    ##   ## If Business Automation Insights and the Machine Learning Server parameters are configured, this parameter must be set to true.
    ##   enable: false
    ##   ## Whether to enable the task record in generated events. This optional parameter is equivalent to the task-record-enabled parameter,
    ##   ## Also see https://www.ibm.com/support/knowledgecenter/SSYHZ8_20.0.x/com.ibm.dba.bai/topics/ref_bai_bpmn_summary_formats.html
    ##   enable_task_record: true
    ##   ## Whether to record additional task information in generated events.
    ##   ## If Business Automation Insights and the Machine Learning Server parameters are configured, this parameter must be set to true.
    ##   ## This parameter is equivalent to the enable_task_api_def parameter.
    ##   ## Also see https://www.ibm.com/support/knowledgecenter/SSYHZ8_20.0.x/com.ibm.dba.bai/topics/ref_bai_bpmn_summary_formats.html
    ##   enable_task_api: false
    ##   ## List of the subscription configurations. Each subscription attribute is listed in the rest of this table.
    ##   ## app_name: Name of the application that is the source of the events that are to be monitored.
    ##   ## version: Version of the application to be monitored.
    ##   ## component_type: Type of the component to be monitored.
    ##   ## component_name: Name of the component to be monitored.
    ##   ## element_type: Type of element to be monitored. BPMN types are PROCESS, ACTIVITY, EVENT, and GATEWAY.
    ##   ## element_name: Name of the element to be monitored.
    ##   ## nature: Nature of the event. One element can send events of various natures, such as STARTED, ACTIVE, COMPLETED.
    ##   ##         The BPMN nature categories are STARTED, COMPLETED, TERMINATED, DELETED, FAILED, CAUGHT, THROWN, EXPECTED, ACTIVE, READY, RESOURCE_ASSIGNED, ACTIVE, LOOP_CONDITION_TRUE, LOOP_CONDITION_FALSE, and MULTIPLE_INSTANCES_STARTED.
    ##   subscription:
    ##   - {'app_name': '*','version': '*','component_type': '*','component_name': '*','element_type': '*','element_name': '*','nature': '*'}

    ## elasticsearch:
    ##   ## Required only when you want to use external elasticsearch/opensearch for "data collector and data indexer" function. Endpoint of external elasticsearch/opensearch, such as: https://<external_es_host>:<external_es_port>.
    ##   endpoint: ""
    ##   ## Required only when you want to use external elasticsearch/opensearch for "data collector and data indexer" function. The external elasticsearch/opensearch administrative secret that contains the keys: username and password.
    ##   ## If your instance does not have basic authentication, leave this parameter empty.
    ##   admin_secret_name: ""
    ##   ## Optionally specify the number of seconds for elasticsearch/opensearch connection timeout.
    ##   connect_timeout: 10s
    ##   ## Optionally specify the number of seconds for elasticsearch/opensearch read timeout.
    ##   read_timeout: 30s
    ##   ## Optionally specify elasticsearch/opensearch thread count.
    ##   thread_count: 0
    ##   ## Optionally specify the maximum number of connections allowed across all routes when workflow authoring service connects to the elasticsearch/opensearch cluster to call its REST API.
    ##   ## Specify a positive integer. If the provided value is less than or equal to 0, then the default Elasticsearch/Opensearch High Level REST Client value will be used.
    ##   max_connection_total: -1
    ##   ## Optionally specify the maximum number of connections allowed for a route when workflow authoring service connects to the elasticsearch/opensearch cluster to call its REST API.
    ##   ## Specify a positive integer. If the provided value is less than or equal to 0, then the default Elasticsearch/Opensearch High Level REST Client value will be used.
    ##   max_connection_per_route: -1

  workflow_assistant_configuration:
    run_authoring_agent: ${CP4BA_RUN_AUTHORING_AGENT}
    run_workplace_agent: ${CP4BA_RUN_WORKPLACE_AGENT}

  # IBM FileNet Content Manager configuration
  ecm_configuration:
    fncm_secret_name: ibm-fncm-secret
    cpe:
      datavolume:
        existing_pvc_for_cpe_cfgstore:
          name: "cpe-cfgstore"
          size: ${CP4BA_INST_CPE_DATAVOLUME_STORAGE_SIZE_SMALL}
        existing_pvc_for_cpe_logstore:
          name: "cpe-logstore"
          size: ${CP4BA_INST_CPE_DATAVOLUME_STORAGE_SIZE_SMALL}
        existing_pvc_for_cpe_filestore:
          name: "cpe-filestore"
          size: ${CP4BA_INST_CPE_DATAVOLUME_STORAGE_SIZE_MEDIUM}
        existing_pvc_for_cpe_icmrulestore:
          name: "cpe-icmrulesstore"
          size: ${CP4BA_INST_CPE_DATAVOLUME_STORAGE_SIZE_SMALL}
        existing_pvc_for_cpe_textextstore:
          name: "cpe-textextstore"
          size: ${CP4BA_INST_CPE_DATAVOLUME_STORAGE_SIZE_MEDIUM}
        existing_pvc_for_cpe_bootstrapstore:
          name: "cpe-bootstrapstore"
          size: ${CP4BA_INST_CPE_DATAVOLUME_STORAGE_SIZE_SMALL}
        existing_pvc_for_cpe_fnlogstore:
          name: "cpe-fnlogstore"
          size: ${CP4BA_INST_CPE_DATAVOLUME_STORAGE_SIZE_MEDIUM}

    graphql:
      graphql_production_setting:
        enable_graph_iql: ${CP4BA_INST_GRAPHQL}


  # BAN
  # https://www.ibm.com/docs/en/cloud-paks/cp-biz-automation/25.0.1?topic=parameters-business-automation-navigator
  navigator_configuration:
    ## Navigator secret that contains user credentials for LDAP and database
    ban_secret_name: ibm-ban-secret
    replica_count: 1
    image:
      ## The default repository is the IBM Entitled Registry
      repository: cp.icr.io/cp/cp4a/ban/navigator
      tag: "${CP4BA_INST_IMGTAG}"
      pull_policy: IfNotPresent
    log:
      format: json
    resources:
      requests:
        cpu: 1
        memory: 3072Mi
        ephemeral_storage: 1Gi
      limits:
        cpu: 1
        memory: 3072Mi
        ephemeral_storage: 2.5Gi
    disable_fips: false
    disable_basic_auth: true

    ## Below are the default ICN Production settings.  Make the necessary changes as you see fit.  Refer to Knowledge Center documentation for details.
    icn_production_setting:
      timezone: Etc/UTC
      icn_jndids_name: ECMClientDS
      icn_schema: "${CP4BA_INST_DB_ICN_USER}"
      icn_table_space: "${CP4BA_INST_DB_ICN_USER}_icndb_tbs"
      allow_remote_plugins_via_http: false
    monitor_enabled: false
    logging_enabled: false

    datavolume:
      existing_pvc_for_icn_cfgstore: 
        name: "icn-cfgstore"
        size: 1Gi
      existing_pvc_for_icn_logstore: 
        name: "icn-logstore"
        size: 1Gi
      existing_pvc_for_icn_pluginstore: 
        name: "icn-pluginstore"
        size: 1Gi
      existing_pvc_for_icnvw_cachestore: 
        name: "icn-vw-cachestore"
        size: 1Gi
      existing_pvc_for_icnvw_logstore: 
        name: "icn-vw-logstore"
        size: 1Gi
      existing_pvc_for_icn_aspera: 
        name: "icn-asperastore" 
        size: 1Gi

    probe:
      startup:
        initial_delay_seconds: 120
        period_seconds: 10
        timeout_seconds: 10
        failure_threshold: 6
      readiness:
        period_seconds: 10
        timeout_seconds: 10
        failure_threshold: 6
      liveness:
        period_seconds: 10
        timeout_seconds: 5
        failure_threshold: 6

    image_pull_secrets:
      name: "ibm-entitlement-key"
    use_sync_with_zen_url: true
